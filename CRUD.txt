<!DOCTYPE html>
<html>
<body>
<h2>Student Database Client</h2>
<h3>Register Student</h3>
<form onsubmit="register(event)">
  Name: <input id="r_name"><br>
  ID: <input id="r_id"><br>
  Course: <input id="r_course"><br>
  Branch: <input id="r_branch"><br><br>
  <button type="submit">Register</button>
</form>
<h3>Fetch Student</h3>
<form onsubmit="fetchData(event)">
  Roll No: <input id="f_id"><br><br>
  <button type="submit">Fetch</button>
</form>
<h3>Update Student</h3>
<form onsubmit="updateData(event)">
  Existing Name: <input id="u_old_name"><br>
  New Name: <input id="u_name"><br>
  New ID: <input id="u_id"><br>
  New Course: <input id="u_course"><br>
  New Branch: <input id="u_branch"><br><br>
  <button type="submit">Update</button>
</form>
<h3>Delete Student</h3>
<form onsubmit="deleteData(event)">
  Roll No: <input id="d_id"><br><br>
  <button type="submit">Delete</button>
</form>
<div id="output"></div>
<script>
async function register(e){
  e.preventDefault();
  let body = {
    name: r_name.value,
    id: r_id.value,
    course: r_course.value,
    branch: r_branch.value
  };
  let res = await fetch("http://localhost:3000/register", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(body)
  });
  output.innerHTML = await res.text();
}
async function fetchData(e){
  e.preventDefault();
  let res = await fetch("http://localhost:3000/fetch/" + f_id.value);
output.innerHTML = `<pre>${JSON.stringify(await res.json())}<pre>`;

}
async function updateData(e){
  e.preventDefault();
  let body = {
    oldName: u_old_name.value,
    name: u_name.value,
    id: u_id.value,
    course: u_course.value,
    branch: u_branch.value
  };
  let res = await fetch("http://localhost:3000/update", {
    method: "PUT",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(body)
  });
  output.innerHTML = await res.text();
}
async function deleteData(e){
  e.preventDefault();
  let res = await fetch("http://localhost:3000/delete", {
    method: "DELETE",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({id: d_id.value})
  });
  output.innerHTML = await res.text();
}
</script>
</body>
</html>


  const express = require("express");
const mongoose = require("mongoose");
const cors = require("cors");
const app = express();
app.use(express.json());
app.use(cors());
mongoose
  .connect("mongodb://localhost:27017/wtexternal")
  .then(() => console.log("MongoDB Connected"))
  .catch((err) => console.log(err));
const studentSchema = new mongoose.Schema({
  name: String,
  id: String,
  course: String,
  branch: String,
});
const Student = mongoose.model("students", studentSchema);
app.post("/register", async (req, res) => {
  try {
    await Student.create(req.body);
    res.send("Student Registered Successfully");
  } catch (e) {
    res.send("Failed to register student");
  }
}); 
app.get("/fetch/:id", async (req, res) => {
  let stu = await Student.find({ id: req.params.id });
  res.json(stu);
});
app.put("/update", async (req, res) => {
  const { oldName, name, id, course, branch } = req.body;
  try {
    let result = await Student.findOneAndUpdate(
      { name: oldName },
      {name, id, course, branch },
        { new: true }
    );
    res.send("Student Updated Successfully");
  } catch (e) {
    res.send("Update Failed");
  }
});
app.delete("/delete", async (req, res) => {
  try {
    await Student.deleteOne({ id: req.body.id });
    res.send("Student Deleted Successfully");
  } catch (e) {
    res.send("Delete Failed");
  }
});
app.listen(3000, () => console.log("Server running on port 3000"));
